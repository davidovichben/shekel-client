<div class="open-debts-tab">
  <!-- Header with title and total -->
  <div class="tab-header">
    <div class="header-right">
      <h2>חובות פתוחים:</h2>
      <span class="total-amount">סך כל החובות הפתוחים: <span class="amount-value">{{ totalAmount }} ש"ח</span></span>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="action-bar">
    <div class="action-buttons">
      <button class="btn-action btn-primary-action" (click)="onPaySelectedDebts()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        ביצוע תשלום על חובות נבחרים
      </button>
      <button class="btn-action btn-secondary-action" (click)="onSendReminders()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
        שלח תזכורת
      </button>
      <button class="btn-action btn-secondary-action" (click)="onPrint()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 6 2 18 2 18 9"></polyline>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
          <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        הדפס
      </button>
      <button class="btn-action btn-secondary-action" (click)="onExportToFile()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        ייצא לקובץ
      </button>
    </div>
  </div>

  <!-- Debts table -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th class="col-number">#</th>
          <th class="col-checkbox">
            <input type="checkbox"
                   [checked]="isAllSelected()"
                   (change)="toggleAllSelection($event)">
          </th>
          <th>תיאור חוב</th>
          <th>סוג חוב</th>
          <th>סכום</th>
          <th>סטטוס</th>
          <th>תאריך עברי</th>
          <th>תאריך לועזי</th>
          <th class="col-actions">פעולות</th>
        </tr>
      </thead>
      <tbody>
        @if (isLoading) {
          <tr>
            <td colspan="9" class="loading-cell">
              <div class="spinner"></div>
            </td>
          </tr>
        } @else if (debts.length === 0) {
          <tr>
            <td colspan="9" class="empty-cell">אין חובות פתוחים</td>
          </tr>
        } @else {
          @for (debt of debts; track debt.id; let i = $index) {
            <tr>
              <td class="col-number">{{ i + 1 }}</td>
              <td class="col-checkbox">
                <input type="checkbox"
                       [checked]="isDebtSelected(debt.id)"
                       (change)="toggleDebtSelection(debt.id, $event)">
              </td>
              <td>{{ debt.description || 'נדר שבת דברים' }}</td>
              <td>{{ getDebtTypeLabel(debt.description) }}</td>
              <td>{{ debt.amount }}ש"ח</td>
              <td>
                <span class="status-badge" [class.unpaid]="debt.status === 'pending' || debt.status === 'overdue'">
                  {{ getStatusLabel(debt.status) }}
                </span>
              </td>
              <td>{{ debt.hebrewDate || 'כה\' אב תשפ"ה' }}</td>
              <td>{{ debt.gregorianDate || '11/05/2025' }}</td>
              <td class="col-actions">
                <button class="row-action" title="שלח תזכורת" (click)="onSendReminder(debt)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                  </svg>
                </button>
                <button class="row-action" title="ערוך" (click)="onEditDebt(debt)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button class="row-action" title="מחק" (click)="onDeleteDebt(debt)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
                <button class="row-action" title="צפה" (click)="onViewDebt(debt)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                  </svg>
                </button>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>
</div>
