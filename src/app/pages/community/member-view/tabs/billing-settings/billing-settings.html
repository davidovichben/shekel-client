<div class="billing-settings-tab">
  <div class="settings-layout" [class.disabled]="!shouldBill">

    <!-- Right side: Billing settings -->
    <div class="settings-panel">
      <div class="panel-header">
        <h2>הגדרות החיוב במערכת</h2>
        <p>הרשאות והעדפות חבר הקהילה</p>
      </div>

      <div class="panel-content">
        <!-- Auto monthly charge toggle -->
        <div class="setting-row">
          <label class="toggle-label">בצע חיוב אוטומטי חודשי</label>
          <label class="toggle-switch">
            <input type="checkbox" [(ngModel)]="shouldBill" (ngModelChange)="onShouldBillChange()">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <!-- Billing day -->
        <div class="setting-row vertical" [class.disabled]="!shouldBill">
          <label>יום לחיוב אוטומטי:</label>
          <app-custom-select
            [options]="chargeDayOptions"
            [(value)]="billingDate"
            (valueChange)="onBillingDateChange()"
            placeholder="בחר יום"
            [disabled]="!shouldBill"
          ></app-custom-select>
        </div>
      </div>

      <!-- Billing type section -->
      <div class="payment-type-section" [class.disabled]="!shouldBill">
        <h3>סוג תשלום:</h3>
        <p class="payment-type-description">בחר בסוג התשלום המועדף ממנו יבוצע החיוב האוטומטי פעם בחודש</p>

        <div class="payment-type-options">
          <label class="radio-option">
            <input type="radio" name="billingType" value="credit_card" [(ngModel)]="billingType" (ngModelChange)="onBillingTypeChange()" [disabled]="!shouldBill">
            <span class="radio-custom"></span>
            <span class="radio-label">כרטיסי אשראי</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="billingType" value="bank" [(ngModel)]="billingType" (ngModelChange)="onBillingTypeChange()" [disabled]="!shouldBill">
            <span class="radio-custom"></span>
            <span class="radio-label">הוראה לחיוב מס"ב</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="billingType" value="bit" [(ngModel)]="billingType" (ngModelChange)="onBillingTypeChange()" [disabled]="!shouldBill">
            <span class="radio-custom"></span>
            <span class="radio-label">ביט</span>
          </label>
        </div>

        @if (shouldBill && creditCardsLoaded && creditCards.length === 0 && billingType === 'credit_card') {
          <div class="warning-notice">
            <span>לחבר קהילה זה לא קיים כרטיס אשראי במערכת - להוספת כרטיס חדש עבור לטאב אמצעי תשלום</span>
            <i class="fa-solid fa-exclamation-circle"></i>
          </div>
        }

        @if (shouldBill && billingType === 'bit') {
          <div class="warning-notice">
            <span>בבחירת האפשרות לתשלום בביט התשלום לא מתבצע אוטומטית במועד אלא רק נשלחת דרישת תשלום.</span>
            <i class="fa-solid fa-exclamation-circle"></i>
          </div>
        }
      </div>
    </div>

    <!-- Left side: Payment details (toggles based on billing type) -->
    <div class="payment-details-panel">
      @if (billingType === 'credit_card') {
        @if (!creditCardsLoaded) {
          <div class="spinner-container">
            <i class="fa-solid fa-spinner fa-spin"></i>
          </div>
        } @else if (creditCards.length === 0) {
          <div class="no-cards-placeholder">
            <div class="placeholder-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                <line x1="1" y1="10" x2="23" y2="10"></line>
              </svg>
            </div>
            <p>אין כרטיסי אשראי</p>
            <span class="placeholder-hint">להוספת כרטיס חדש עבור לטאב אמצעי תשלום</span>
          </div>
        } @else {
          <app-credit-cards
            [cards]="creditCards"
            [(selectedCardId)]="selectedCreditCard"
            (selectedCardIdChange)="onSelectedCreditCardChange()"
          ></app-credit-cards>
        }
      } @else if (billingType === 'bank') {
        <app-bank-account
          [(data)]="bankAccountData"
        ></app-bank-account>
      } @else if (billingType === 'bit') {
        <div class="bit-section">
          <h3>תשלום באמצעות ביט</h3>
          <p>בקרוב...</p>
        </div>
      }
    </div>

  </div>
</div>
