<div class="payment-archive-tab">
  <!-- Header with title and total -->
  <div class="tab-header">
    <div class="header-right">
      <h2>ארכיון תשלומים:</h2>
      <span class="total-amount">סך כל התשלומים: <span class="amount-value">{{ totalAmount }} ₪</span></span>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="action-bar">
    <div class="action-buttons">
      <button class="btn-action btn-secondary-action" (click)="onPrint()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 6 2 18 2 18 9"></polyline>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
          <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        הדפס
      </button>
      <button class="btn-action btn-secondary-action" (click)="onExportToFile()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        ייצא לקובץ
      </button>
    </div>
  </div>

  <!-- Payments table -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th class="col-number">#</th>
          <th class="col-checkbox">
            <input type="checkbox"
                   [checked]="isAllSelected()"
                   (change)="toggleAllSelection($event)">
          </th>
          <th>תיאור חוב</th>
          <th>סוג חוב</th>
          <th>סכום</th>
          <th>סטטוס</th>
          <th>תאריך עברי</th>
          <th>תאריך לועזי</th>
          <th class="col-actions">פעולות</th>
        </tr>
      </thead>
      <tbody>
        @if (isLoading) {
          <tr>
            <td colspan="9" class="loading-cell">
              <div class="spinner"></div>
            </td>
          </tr>
        } @else if (payments.length === 0) {
          <tr>
            <td colspan="9" class="empty-cell">אין תשלומים בארכיון</td>
          </tr>
        } @else {
          @for (payment of payments; track payment.id; let i = $index) {
            <tr>
              <td class="col-number">{{ i + 1 }}</td>
              <td class="col-checkbox">
                <input type="checkbox"
                       [checked]="isPaymentSelected(payment.id)"
                       (change)="togglePaymentSelection(payment.id, $event)">
              </td>
              <td>{{ payment.description || 'נדר שבת דברים' }}</td>
              <td>{{ getDebtTypeLabel(payment.description) }}</td>
              <td>{{ payment.amount }}₪</td>
              <td>
                <span class="status-badge" [class.paid]="payment.status === 'paid'">
                  {{ getStatusLabel(payment.status) }}
                </span>
              </td>
              <td>{{ payment.hebrewDate || 'כה\' אב תשפ"ה' }}</td>
              <td>{{ payment.gregorianDate || '11/05/2025' }}</td>
              <td class="col-actions">
                <button class="row-action" title="ערוך" (click)="onEditPayment(payment)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button class="row-action" title="מחק" (click)="onDeletePayment(payment)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
                <button class="row-action" title="צפה" (click)="onViewPayment(payment)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                  </svg>
                </button>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>
</div>
