<div class="member-form-dialog">
  <div class="dialog-header">
    <button class="close-btn" (click)="onCancel()" [disabled]="isSaving">
      <img src="assets/img/icons/close.svg" alt="" class="close-icon">
    </button>
    <h2>{{ isEditMode ? 'עריכת חבר' : 'הוסף חבר חדש' }}</h2>
  </div>

  <div class="dialog-content">
    @if (isLoading) {
      <div class="loading-state">
        <div class="spinner"></div>
        <span>טוען נתונים...</span>
      </div>
    } @else {
    <form class="member-form">
      <!-- Row 1: Type, Title, First Name, Last Name -->
      <div class="form-row">
        <div class="form-group">
          <label>שם פרטי: <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formData.firstName" name="firstName" placeholder="יוחנן">
        </div>
        <div class="form-group">
          <label>שם משפחה: <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formData.lastName" name="lastName" placeholder="יוחננוף">
        </div>
        <div class="form-group">
          <label>תואר:</label>
          <app-custom-select
            [options]="titleOptions"
            [(value)]="formData.title"
            placeholder="מר"
          ></app-custom-select>
        </div>
        <div class="form-group">
          <label>סיווג:</label>
          <app-custom-select
            [options]="typeOptions"
            [(value)]="formData.type"
            placeholder="חבר קהילה"
          ></app-custom-select>
        </div>
      </div>

      <!-- Row 2: Email, Mobile -->
      <div class="form-row">
        <div class="form-group">
          <label>מספר נייד:</label>
          <input type="tel" [(ngModel)]="formData.mobile" name="mobile" placeholder="058-448-2254" class="ltr-input">
        </div>
        <div class="form-group">
          <label>דוא"ל:</label>
          <input type="email" [(ngModel)]="formData.email" name="email" placeholder="email@gmail.com" [class.invalid]="formData.email && !isValidEmail(formData.email)">
          @if (formData.email && !isValidEmail(formData.email)) {
            <span class="error-message">כתובת דוא"ל לא תקינה</span>
          }
        </div>
        <div class="form-group empty"></div>
        <div class="form-group empty"></div>
      </div>

      <!-- Row 3: Country, City, Street, House Number, Apartment Number -->
      <div class="form-row">
        <div class="form-group">
          <label>ארץ:</label>
          <input type="text" [(ngModel)]="formData.country" name="country" placeholder="ישראל">
        </div>
        <div class="form-group">
          <label>עיר:</label>
          <input type="text" [(ngModel)]="formData.city" name="city" placeholder="בני ברק">
        </div>
        <div class="form-group">
          <label>רחוב:</label>
          <input type="text" [(ngModel)]="formData.address" name="address" placeholder="זבולון">
        </div>
        <div class="form-group small">
          <label>מספר בית:</label>
          <input type="text" [(ngModel)]="formData.address2" name="address2" placeholder="87">
        </div>
        <div class="form-group small">
          <label>מספר דירה:</label>
          <input type="text" [(ngModel)]="formData.zipcode" name="zipcode" placeholder="5">
        </div>
      </div>
    </form>
    }
  </div>

  <!-- Footer Buttons -->
  <div class="dialog-footer">
    @if (isDevMode && !isLoading) {
      <button type="button" class="btn-dev" (click)="fillTestData()" [disabled]="isSaving">מלא נתוני בדיקה</button>
    }
    <button type="button" class="btn-cancel" (click)="onCancel()" [disabled]="isSaving">בטל</button>
    <button type="button" class="btn-save" (click)="onSave()" [disabled]="isLoading || isSaving">
      @if (isSaving) {
        <div class="btn-spinner"></div>
        שומר...
      } @else {
        <span class="btn-icon">
          <img src="/assets/img/icons/save.svg" alt="Save" />
        </span>
        שמור
      }
    </button>
  </div>
</div>
