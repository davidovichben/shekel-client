<div class="dialog-container">
    <div class="dialog-header">
      <button class="close-btn" (click)="onClose()">
        <img src="assets/img/icons/close.svg" alt="" class="close-icon">
      </button>
      <h2>{{ isEditMode ? 'הוצאה - ' + (expense.description || 'ללא תיאור') : 'יצירת הוצאה חדשה' }}</h2>
      <div class="header-left">
        <app-toggle-switch
          [(ngModel)]="isPaid"
          (toggleChange)="onPaidToggleChange($event)"
          label="שולם"
          [ngModelOptions]="{standalone: true}">
        </app-toggle-switch>
      </div>
    </div>

    <form (ngSubmit)="onSubmit()">
      <div class="form-content">
        <div class="form-grid">
          <!-- Row 1 -->
          <div class="form-row">
            <div class="form-group">
              <label class="required">סכום:</label>
              <div class="amount-input">
                <input type="number" [(ngModel)]="expense.amount" name="amount" placeholder="" min="0" step="0.01" required>
                <span class="currency">₪</span>
              </div>
            </div>
            <div class="form-group">
              <label>תיאור הוצאה:</label>
              <input type="text" [(ngModel)]="expense.description" name="description" placeholder="">
            </div>
          </div>

          <!-- Row 2 -->
          <div class="form-row">
            <div class="form-group">
              <label class="required">תאריך תשלום:</label>
              <input type="date" [(ngModel)]="expense.date" name="date" required>
            </div>
            <div class="form-group">
              <label class="required">ספק:</label>
              <app-member-autocomplete
                [memberName]="expense.supplierName"
                [memberType]="'supplier'"
                (memberSelected)="onMemberSelected($event)"
                placeholder="חיפוש ספק...">
              </app-member-autocomplete>
            </div>
          </div>

          <!-- Row 3 -->
          <div class="form-row">
            <div class="form-group">
              <label>סוג הוצאה:</label>
              <app-custom-select
                [options]="expenseTypeOptions"
                [(value)]="expense.type"
                placeholder="בחר סוג הוצאה">
              </app-custom-select>
            </div>
            <div class="form-group">
              <label>קבלה:</label>
              <app-file-upload
                (fileSelected)="onReceiptFileSelected($event)">
              </app-file-upload>
              <div class="existing-receipt" *ngIf="existingReceiptPath && !receiptFile">
                <span class="receipt-name">{{ existingReceiptPath }}</span>
              </div>
            </div>
          </div>

          <!-- Row 4 -->
          <div class="form-row">
            <div class="form-group">
              <label>תדירות:</label>
              <app-custom-select
                [options]="frequencyOptions"
                [(value)]="expense.frequency"
                placeholder="בחר תדירות">
              </app-custom-select>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        @if (isEditMode) {
          <button type="button" class="btn-delete" (click)="onDelete()">
            <img src="assets/img/icons/trash.svg" alt="Delete" class="btn-icon" />
            מחק הוצאה
          </button>
          <button type="submit" class="btn-save" [disabled]="isSubmitting">
            <img src="assets/img/icons/floppy.svg" alt="Save" class="btn-icon" />
            {{ isSubmitting ? 'שומר...' : 'שמור שינויים' }}
          </button>
        } @else {
          <button type="submit" class="btn-save" [disabled]="isSubmitting">
            <img src="assets/img/icons/floppy.svg" alt="Create" class="btn-icon" />
            {{ isSubmitting ? 'יוצר...' : 'צור הוצאה' }}
          </button>
        }
      </div>
    </form>
</div>

