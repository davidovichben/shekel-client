<div class="invoices">
  <!-- Header -->
  <div class="page-header">
    <div class="page-header-text">
      <h1>חשבוניות מס / קבלות</h1>
      <p>כאן ניתן למצוא ליצור ולנהל את כל החשבוניות או הקבלות שנוצרו במערכת</p>
    </div>
    <button class="btn-primary" (click)="openCreateDialog()">
      <img src="/assets/img/icons/plus_circle.svg" alt="" class="btn-icon">
      צור חשבונית/קבלה
    </button>
  </div>

  <!-- Tabs -->
  <div class="tabs-container">
    <div class="tabs">
      @for (tab of tabs; track tab.id) {
        <button
          class="tab"
          [class.active]="activeTab === tab.id"
          (click)="onTabClick(tab.id)">
          {{ tab.label }}
          @if (tab.count !== null) {
            <span class="count">({{ tab.count }})</span>
          }
        </button>
      }
    </div>
    <button class="filter-btn">
      <i class="fa-solid fa-filter"></i>
      פילטרים נוספים
    </button>
  </div>

  <!-- Search and Actions -->
  <div class="table-header">
    <div class="filters">
      <app-custom-select
        [options]="displayRangeOptions"
        [(value)]="displayRange"
        prefix="הצג חשבוניות">
      </app-custom-select>
      <app-custom-select
        [options]="sortOptions"
        [value]="sortBy"
        [sortOrder]="sortOrder"
        (valueChange)="onSortChange($event)"
        prefix="מיין לפי">
      </app-custom-select>
    </div>
    <div class="table-actions">
      <div class="bulk-actions">
        <span>פעולות קולקטיביות:</span>
        <button type="button" class="action-icon" (click)="onBulkAction('print')"><img src="assets/img/icons/print.svg" alt=""></button>
        <button type="button" class="action-icon" (click)="onBulkAction('delete')"><img src="assets/img/icons/trash.svg" alt=""></button>
        <button type="button" class="action-icon" (click)="onBulkAction('email')"><i class="fa-regular fa-envelope"></i></button>
      </div>
      <div class="export-action">
        <button class="btn-outline" (click)="openExportDialog()">ייצא לקובץ</button>
      </div>
    </div>
  </div>

  <!-- Table -->
  <app-data-table
    [isLoading]="isLoading"
    [columns]="tableColumns"
    [data]="invoices"
    [totalItems]="totalInvoices"
    [currentPage]="currentPage"
    [itemsPerPage]="itemsPerPage"
    [totalPages]="totalPages"
    [allSelected]="areAllSelected()"
    (pageChange)="onPageChange($event)"
    (selectAll)="onSelectAll($event)">
    @for (invoice of invoices; track invoice.id) {
      <tr>
        <td class="col-number">{{ invoice.id }}</td>
        <td class="col-checkbox">
          <input type="checkbox"
                 [checked]="isInvoiceSelected(invoice.id)"
                 (change)="toggleInvoiceSelection(invoice.id, $event)">
        </td>
        <td class="clickable" (click)="navigateToInvoice(invoice)">{{ invoice.payerName }}</td>
        <td>{{ invoice.invoiceNumber }}</td>
        <td><span class="amount">{{ invoice.totalAmount }} ש"ח</span></td>
        <td>{{ invoice.type }}</td>
        <td>{{ invoice.hebrewDate }}</td>
        <td>{{ invoice.gregorianDate }}</td>
        <td>{{ invoice.paymentMethod }}</td>
        <td class="col-actions">
          <button type="button" class="row-action" (click)="duplicateInvoice(invoice)"><img src="assets/img/icons/copy.svg" alt="" class="action-icon"></button>
          <button type="button" class="row-action" (click)="openEditDialog(invoice)"><img src="assets/img/icons/edit.svg" alt="" class="action-icon"></button>
          <button type="button" class="row-action" (click)="shareInvoice(invoice)"><img src="assets/img/icons/share.svg" alt="" class="action-icon"></button>
        </td>
      </tr>
    }
  </app-data-table>

  <!-- Footer -->
  <div class="table-footer">
    <span class="footer-message">(נמצאו {{ totalInvoices }} רשומות, סה"כ סכום החשבוניות כהן הוא: <span class="bold">{{ getTotalAmount() }} ש"ח</span>)</span>
    <!-- Pagination -->
    <div class="pagination">
      <button class="page-btn" (click)="onPageChange(1)" [disabled]="currentPage === 1">
        <i class="fa-solid fa-angles-right"></i>
      </button>
      <button class="page-btn" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
        <i class="fa-solid fa-angle-right"></i>
      </button>

      @for (page of getPageNumbers(); track page) {
        <button
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="onPageChange(page)">
          {{ page }}
        </button>
      }

      <button class="page-btn" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
        <i class="fa-solid fa-angle-left"></i>
      </button>
      <button class="page-btn" (click)="onPageChange(totalPages)" [disabled]="currentPage === totalPages">
        <i class="fa-solid fa-angles-left"></i>
      </button>
    </div>
  </div>
</div>
